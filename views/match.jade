extends layout

mixin players_header(side)
	thead
		tr
			th(colspan=2) Player
			th(colspan=2) Hero
			th Level
			th K
			th D
			th A
			th Gold
			th LH
			th DN
			th XPM
			th GPM
			th Items

mixin player_block(player)
	tr
		if player.account_id == butt.anon
			td &nbsp;
			td: em Anonymous
		else
			td: img(src='#{player.summary.avatar}')
			td: a(href='/players/#{player.account_id}') #{player.summary.personaname}
		td: img(src='http://media.steampowered.com/apps/dota2/images/heroes/#{heroes[player.hero_id].short_name}_sb.png')
		td= heroes[player.hero_id].localized_name
		td= player.level
		td= player.kills
		td= player.deaths
		td= player.assists
		td= player.gold
		td= player.last_hits
		td= player.denies
		td= player.gold_per_min
		td= player.xp_per_min
		td - - - - - -

block content
	h1 Match #{match.match_id}
	p: a(href='dota2://matchid=#{match.match_id}') Watch replay
	div.towermap
		if match.radiant_win
			div.radiant-ancient &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.ancient.top
			div.radiant-tower-ancient-top &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.ancient.bottom
			div.radiant-tower-ancient-bottom &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.top.ranged
			div.radiant-barracks-top-ranged &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.top.melee
			div.radiant-barracks-top-melee &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.middle.ranged
			div.radiant-barracks-middle-ranged &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.middle.melee
			div.radiant-barracks-middle-melee &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.bottom.ranged
			div.radiant-barracks-bottom-ranged &nbsp;
		if match.barracks_status_radiant & steamapi.dota2.barracks.bottom.melee
			div.radiant-barracks-bottom-melee &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier1.top
			div.radiant-tower-tier1-top &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier1.middle
			div.radiant-tower-tier1-middle &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier1.bottom
			div.radiant-tower-tier1-bottom &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier2.top
			div.radiant-tower-tier2-top &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier2.middle
			div.radiant-tower-tier2-middle &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier2.bottom
			div.radiant-tower-tier2-bottom &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier3.top
			div.radiant-tower-tier3-top &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier3.middle
			div.radiant-tower-tier3-middle &nbsp;
		if match.tower_status_radiant & steamapi.dota2.tower.tier3.bottom
			div.radiant-tower-tier3-bottom &nbsp;
		if !match.radiant_win
			div.dire-ancient &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.ancient.top
			div.dire-tower-ancient-top &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.ancient.bottom
			div.dire-tower-ancient-bottom &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.top.ranged
			div.dire-barracks-top-ranged &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.top.melee
			div.dire-barracks-top-melee &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.middle.ranged
			div.dire-barracks-middle-ranged &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.middle.melee
			div.dire-barracks-middle-melee &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.bottom.ranged
			div.dire-barracks-bottom-ranged &nbsp;
		if match.barracks_status_dire & steamapi.dota2.barracks.bottom.melee
			div.dire-barracks-bottom-melee &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier1.top
			div.dire-tower-tier1-top &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier1.middle
			div.dire-tower-tier1-middle &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier1.bottom
			div.dire-tower-tier1-bottom &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier2.top
			div.dire-tower-tier2-top &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier2.middle
			div.dire-tower-tier2-middle &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier2.bottom
			div.dire-tower-tier2-bottom &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier3.top
			div.dire-tower-tier3-top &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier3.middle
			div.dire-tower-tier3-middle &nbsp;
		if match.tower_status_dire & steamapi.dota2.tower.tier3.bottom
			div.dire-tower-tier3-bottom &nbsp;
	if match.radiant_win
		p Radiant victory
	else
		p Dire victory
	
	h2 Radiant
	table
		mixin players_header('Radiant')
		tbody
			for player in match.players
				if player.player_slot < 127
					mixin player_block(player)
	
	h2 Dire
	table
		mixin players_header('Dire')
		tbody
			for player in match.players
				if player.player_slot > 127
					mixin player_block(player)